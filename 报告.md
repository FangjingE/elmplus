[TOC]



## 1.项目需求

### 1.1简介

#### 1.1.1背景

在已经完成的“饿了么”项目中，增加两个新功能模块，即虚拟钱包模块和积分系统模块，新增的两个功能模块与原功能模块融合为一个新的系统。

#### 1.1.2约束

- 无需改造除订单组件外其它的功能组件
- 不需要实现第三方银行系统，充值和提现模拟实现即可

#### 1.1.3参考资料

- 老师给的大作业任务书
- [(182条消息) 设计模式之美-11| 实战一（下）：如何利用基于充血模型的DDD开发一个虚拟钱包系统？_如我般骄傲的博客-CSDN博客](https://blog.csdn.net/qq_38173650/article/details/122918583)
- [(182条消息) 设计模式：积分兑换系统的设计与实现_OceanStar的学习笔记的博客-CSDN博客_积分模型设计](https://blog.csdn.net/zhizhengguan/article/details/122231342)

### 1.2目标、涉众分析和范围

#### 1.2.1目标

- 方便客户购物
- 实现钱包支持充值、提现、支付、查询余额、查询交易流水这五个核心的功能
- 增加客户粘性
- 实现积分获取、消费、查询三个核心功能

#### 1.2.2涉众分析

| 序号 | 涉众 | 代表人物     | 待解决的问题                                                 |
| ---- | ---- | ------------ | ------------------------------------------------------------ |
| 1    | 商家 | 玩家饺子老板 | 商家的虚拟钱包能够收到客户的转账                             |
| 2    | 客户 | 张帅         | 能够使用虚拟钱包向商家转账，可使用积分系统获得积分以及享受折扣 |
| ...  |      |              |                                                              |



#### 1.2.3范围

本系统需要与银行系统对接，不能直接处理现金。

### 1.3业务概念分析

#### 1.3.1概述

本系统主要管理的业务有：虚拟钱包的交易查询，积分系统的获得使用以及查询。

#### 1.3.2业务概念一览

#### ![image-20221126191434804](C:\Users\fanglaozu\AppData\Roaming\Typora\typora-user-images\image-20221126191434804.png)

### 1.4业务流程分析

![image-20221126194358052](C:\Users\fanglaozu\AppData\Roaming\Typora\typora-user-images\image-20221126194358052.png)

### 1.5功能性需求

![image-20221126195241526](C:\Users\fanglaozu\AppData\Roaming\Typora\typora-user-images\image-20221126195241526.png)



## 2.项目设计

### 2.1软件架构与分层设计说明

使用MVC架构。

在po层、controller层、service层和mapper层添加虚拟钱包系统（VirtualWallet）和积分系统(Bonuspoints)的实现文件。其中，入账功能和出账功能（包括虚拟钱包的出入帐和积分系统的增加、使用积分）在虚拟钱包和积分系统的po层实现（充血模型）。而储存两个系统的流水的逻辑都在它们的service层实现：当账户余额被改变时，service层调用po层的getter和setter方法设置流水的各项数值并通过调用mapper层操作储存进数据库。

### 2.2接口说明

- /VirtualWalletController/getWalletbyuserId:通过用户Id获取虚拟钱包实例（用户id即为钱包id）
- /VirtualWalletController/debit：出账
- /VirtualWalletController/credit：入账
- /VirtualWalletController/transfer：转账
- /VirtualWalletController/listtransactionbyid：根据用户id列出钱包流水



- .../BonuspointsController/getBonuspointsbyuserId：通过用户Id获取积分账户实例

- .../BonuspointsController/debit：减少（使用）积分

- .../BonuspointsController/credit：增加（获得）积分

- .../BonuspointsController/listtransactionbyid：根据用户id列出积分流水

  

### 2.3数据库设计

虚拟钱包账户（积分账户类似）：

![image-20221126202154071](C:\Users\fanglaozu\AppData\Roaming\Typora\typora-user-images\image-20221126202154071.png)

虚拟钱包流水：

![image-20221126202236736](C:\Users\fanglaozu\AppData\Roaming\Typora\typora-user-images\image-20221126202236736.png)

积分账户流水：

![image-20221126202312334](C:\Users\fanglaozu\AppData\Roaming\Typora\typora-user-images\image-20221126202312334.png)



## 3.项目测试



## 4.项目部署



## 5.体现了哪些面向对象设计原则

1. 高内聚、松耦合。使用MVC架构分层开发，各层各司其职，松耦合，而各个功能高内聚。以以购买商品时的转账功能实现为例：购买商品转账需要同时调用多个方法，这些方法之间的耦合松散，修改互不影响，而功能高度内聚。
2. 面向接口而非实现编程。以购买商品时的转账功能实现为例：前端并不直接实现这个功能，而是调用服务器的/VirtualWalletController/debit和.../BonuspointsController/credit接口对用户和商家分别作出账、入账处理，mapper层再通过接口操作数据库的余额属性使其增加或减少，整个功能就这样得以实现。
3.  多用组合加委托少用继承。从代码实现来看，虚拟钱包和积分系统的controller层都是先创造一个service层实例，再调用改实例的方法。service层同样先创造mapper层实例，再调用其方法。这提现了多用组合加委托少用继承的设计原则。
4.  开闭原则。对扩展开放，对修改关闭。在MVC三层架构模型里，我们在原有的elm项目的基础上增加功能非常简便，只需要在各层添加相应的组件即可，不需要担心代码会跑不起来，但不能通过修改原有代码来增加功能。

## 6.小组成员及分工



## 7.项目开发过程

## 8.项目进展过程中的问题点与反思

转账时需要同时操作入账和出账两个业务，甚至还要考虑积分的增加减少。这肯定需要用上事务控制，也就是把这些步骤作为一个事务实现或撤销。因为功能逻辑比较简单，这次作业的前端调用入账和出账的接口时没有想到要用事务控制。以后应当注意。